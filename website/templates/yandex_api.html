<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Yandex Map + Photo</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="icon" href="/static/icons/mops_ico.jpg" type="image/jpeg" />
    <script src="api_key_ЯНДЕКС" type="text/javascript"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: row;
        }

        #map {
            width: 50vw;
            height: 100vh;
            flex-shrink: 0;
        }

        #input_file {
            width: 50vw;
            height: 100vh;
            flex-shrink: 0;
            position: relative;
        }

        #input_file a {
            display: block;
            width: 100%;
            height: 100%;
        }

        #input_file a img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="box" id="map"></div>

    <div class="box" id="input_file">
        <h1>Загрузка файлов</h1>

      <form id="uploadForm" enctype="multipart/form-data">
        <label for="fileInput">Выбери файл:</label>
        <input type="file" id="fileInput" name="fileToUpload" required>
        <button type="submit">Загрузить</button>
      </form>

      <p id="result"></p>
      <img id="preview" src="" alt="Preview" width="200" style="display:none; margin-top:10px;">
    </div>

    <script>
        ymaps.ready(init);
        const form = document.getElementById("uploadForm");
        const fileInput = document.getElementById("fileInput");
        const preview = document.getElementById("preview");
        const result = document.getElementById("result");

        // Показываем превью для изображений
        fileInput.addEventListener("change", () => {
          const file = fileInput.files[0];
          if (file && file.type.startsWith("image/")) {
            preview.src = URL.createObjectURL(file);
            preview.style.display = "block";
          } else {
            preview.style.display = "none";
          }
        });

        // Отправка файла на сервер через Fetch API
        form.addEventListener("submit", (e) => {
          e.preventDefault();

          const formData = new FormData();
          formData.append("fileToUpload", fileInput.files[0]);

          fetch("/upload", {
            method: "POST",
            body: formData
          })
          .then(response => response.text())
          .then(data => {
            result.textContent = data;
            fileInput.value = ""; // очищаем input
            preview.style.display = "none";
          })
          .catch(error => {
            result.textContent = "Ошибка загрузки!";
            console.error(error);
          });
        });

        function init() {
            const myMap = new ymaps.Map("map", {
                center: [55.76, 37.64],
                zoom: 10,
                controls: [
                    'zoomControl',
                    'fullscreenControl',
                    'typeSelector',
                    'searchControl',
                    'rulerControl',
                    'trafficControl'
                ]
            });

            const myPlacemark = new ymaps.Placemark(myMap.getCenter(), {}, {
                iconLayout: 'default#image',
                iconImageHref: '/static/icons/mops.jpg',
                iconImageSize: [50, 50],
                iconImageOffset: [-25, -25]
            });

            myMap.geoObjects.add(myPlacemark);
        }
    </script>
</body>
</html>
